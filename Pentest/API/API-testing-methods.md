🔐 عالیه! وقتی یک لیست کامل از API‌های تارگتت داری، عملاً رفتی وسط قلب سیستمش. حالا وقتشه به صورت *منظم، مرحله‌به‌مرحله* تست نفوذ انجام بدی روی اون APIها.

---

## 🎯 هدف کلی:

شناسایی و سوءاستفاده از آسیب‌پذیری‌هایی که در APIها بسیار رایج هستن:
**Auth bypass، IDOR/BOLA، Injection، Rate limit bypass، Mass Assignment، Logic abuse، Broken Object Level Authorization و…**

---

# ✅ لیست کامل حملاتی که می‌تونی روی API انجام بدی

### بر اساس **OWASP API Top 10 2023** + تجربه Red Teaming پیشرفته

| شماره | دسته حمله                                           | نوع تست                                                      | ابزار یا روش پیشنهادی                   |
| ----- | --------------------------------------------------- | ------------------------------------------------------------ | --------------------------------------- |
| A01   | **Broken Object Level Authorization (BOLA)**        | تست IDOR روی مسیرهایی مثل `/api/user/1234`                   | Burp + Intruder, Autorize, ffuf         |
| A02   | **Broken Authentication**                           | تست token reuse, JWT tampering                               | Burp, jwt\_tool, postman                |
| A03   | **Broken Object Property Level Authorization**      | تغییر فیلدهای JSON که نباید قابل ویرایش باشن                 | Burp Repeater, mass assignment payloads |
| A04   | **Unrestricted Resource Consumption (DoS)**         | افزایش size، page، یا loops در body                          | Intruder + big payloads                 |
| A05   | **Broken Function Level Authorization**             | دسترسی به endpointهای ادمین با user معمولی                   | Repeater, Autorize                      |
| A06   | **Unrestricted Access to Sensitive Business Flows** | Abuse endpointهای انتقال، خرید، افزایش موجودی                | Custom scripts / Repeater               |
| A07   | **Server-Side Request Forgery (SSRF)**              | تست فیلدهایی مثل `url`, `callback`, `avatar`, `redirect_uri` | SSRFmap, Burp Collaborator              |
| A08   | **Security Misconfiguration**                       | بررسی پاسخ‌ها، CORS، headers، گاهی .env یا debug فعال        | curl + nuclei + burp passive            |
| A09   | **Improper Inventory Management**                   | پیدا کردن endpointهای deprecated یا staging                  | Gau, Katana, Waybackurls                |
| A10   | **Unsafe Consumption of 3rd Party APIs**            | بررسی ارتباط بین سیستم‌ها، بدون auth/validation              | Burp + fuzzing proxy chain              |

---

# 🛠 چک‌لیست اجرای تست نفوذ روی API

### ✅ 1. Recon و Enumeration

| کار                  | ابزار/روش                            |
| -------------------- | ------------------------------------ |
| جمع‌آوری endpointها  | Katana, gau, waybackurls, burp crawl |
| بررسی WSDL / OpenAPI | `/swagger.json`, `/openapi.json`     |
| تست HTTP methods     | OPTIONS, PUT, PATCH, DELETE          |

---

### ✅ 2. تست دسترسی و مجوز (AuthN/AuthZ)

#### 🧪 تست IDOR (BOLA):

```http
GET /api/user/1234
Authorization: Bearer valid-user-token
```

→ تغییر به `/api/user/1233`, `/api/user/1`

🔧 ابزار: Burp Suite + Autorize + Intruder

---

#### 🧪 تست Mass Assignment:

```json
POST /api/user/update
{
  "name": "test",
  "isAdmin": true,
  "userId": "someone-else-id"
}
```

---

### ✅ 3. Injectionها در API

| نوع               | تست                                             |
| ----------------- | ----------------------------------------------- |
| SQLi              | `"' OR 1=1 --`, `1 AND SLEEP(5)`                |
| XSS               | `"<img src=x onerror=alert(1)>` در فیلدهای text |
| NoSQLi            | `{"username":{"$ne":null}}` در Mongo-style APIs |
| Command Injection | `; whoami` در فیلدهای مثل `hostname`, `script`  |

🔧 ابزار: **sqlmap**, **ghauri**, **XSStrike**, **wfuzz**, **NoSQLMap**

---

### ✅ 4. Rate Limit / Brute Force

* تست ارسال چند request به `/api/otp/verify`, `/api/login` و بررسی تغییر response یا lockout
* ابزار: `ffuf`, `Turbo Intruder`, `Boofuzz`

---

### ✅ 5. JWT / Token Tampering

* Decode JWT:

```bash
jwt_tool eyJhbGciOi...
```

* تست `alg: none` یا تغییر `sub`, `role` در payload

---

### ✅ 6. CORS Misconfig / SSRF / Redirect

| آسیب‌پذیری | فیلد هدف                   | تست                                        |
| ---------- | -------------------------- | ------------------------------------------ |
| CORS       | Origin header              | آیا `*` یا origin ما رو اجازه می‌ده؟       |
| SSRF       | `url`, `callback`, `image` | `http://169.254.169.254/latest/meta-data/` |
| Redirect   | `redirect_uri`, `continue` | `?redirect=http://evil.com`                |

---

### ✅ 7. بررسی لاجیک و Abuse در API

* ارسال مقدارهای عجیب مثل:

```json
{
  "amount": -10000000,
  "dstAccount": "attacker"
}
```

یا:

```json
{
  "itemId": "product-1",
  "price": 0
}
```

---

## 🧰 ابزارهایی که همیشه باید کنارت باشن:

| ابزار                        | کاربرد                                      |
| ---------------------------- | ------------------------------------------- |
| **Burp Suite Pro**           | Repeater, Intruder, Autorize                |
| **Ghauri / sqlmap**          | SQLi blind یا union                         |
| **ffuf / intruder**          | brute API values (IDs, tokens)              |
| **jwt\_tool**                | token manipulation                          |
| **httpx / nuclei**           | passive scanning / headers / tech detect    |
| **Postman / Insomnia**       | سریع‌تر از Burp برای custom API interaction |
| **Boofuzz / Turbo Intruder** | rate-limit or fuzzing-heavy تست‌ها          |

---

## 📁 فاز بعدی

اگر لیست APIها رو داری (مثلاً خروجی Katana یا Swagger)، من می‌تونم:

* تمام endpointها رو دسته‌بندی کنم (GET/POST + هدف حمله)
* برای هر endpoint یک payload پیش‌فرض بسازم
* یک wordlist مخصوص fuzz برای IDها یا roleها آماده کنم

👀 فقط فایل یا لیست raw endpoint‌هات رو برام بده، تا یه pentest plan دقیق روی APIها برات طراحی کنم.

بزن بریم؟
